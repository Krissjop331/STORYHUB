<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>STORYHUB - –£—Ä–æ–∫ 6: –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤</title>
    <link rel="stylesheet" href="css/reset.css" />
    <link rel="stylesheet" href="css/slick.css" />
    <link rel="stylesheet" href="css/jquery.fancybox.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/header-ui.css" />
</head>

  <body>
    <script src="js/site-guard-header.js"></script>
    <!-- –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
    <script>
      const SessionUtils = {
        get: function (name) {
          try {
            return sessionStorage.getItem(name);
          } catch (error) {
            return null;
          }
        },
        remove: function (name) {
          try {
            sessionStorage.removeItem(name);
          } catch (error) {
            return false;
          }
        },
      };

      const AUTH_TOKEN = 'STORYHUB_auth_token';
      const USER_DATA = 'STORYHUB_user_data';
      const SESSION_START = 'STORYHUB_session_start';

      function validateSessionToken(token) {
        if (!token) return false;
        try {
          const tokenData = JSON.parse(atob(token));
          if (
            !tokenData.sessionId ||
            !tokenData.username ||
            !tokenData.createdAt
          )
            return false;
          const sessionStart = SessionUtils.get(SESSION_START);
          if (!sessionStart || tokenData.createdAt < sessionStart) return false;
          return true;
        } catch (error) {
          return false;
        }
      }

      function requireAuth() {
        const token = SessionUtils.get(AUTH_TOKEN);
        const userData = SessionUtils.get(USER_DATA);
        if (!token || !userData || !validateSessionToken(token)) {
          SessionUtils.remove(AUTH_TOKEN);
          SessionUtils.remove(USER_DATA);
          window.location.href = 'index.html';
          return false;
        }
        return true;
      }

      function getCurrentUser() {
        const userData = SessionUtils.get(USER_DATA);
        if (userData && validateSessionToken(SessionUtils.get(AUTH_TOKEN))) {
          try {
            return JSON.parse(userData);
          } catch (error) {
            return null;
          }
        }
        return null;
      }

      function logout() {
        SessionUtils.remove(AUTH_TOKEN);
        SessionUtils.remove(USER_DATA);
        window.location.href = 'index.html';
      }

      if (!requireAuth()) {
        document.documentElement.style.display = 'none';
      }
    </script>

    <header class="header sg-header">
  <div class="container">
    <div class="header_inner">
      <a href="lesson0.html" class="logo">STORY<span>HUB</span></a>
      <div class="header-controls">
        <a href="#" class="admin-panel-btn" id="adminPanelBtn" style="display:none" title="–ü–∞–Ω–µ–ª—å">–ê–¥–º–∏–Ω–∫–∞</a>
        <div class="exit">
          <p class="nameuser" id="userName"></p>
          <a href="#" class="iconexit" id="logoutBtn" title="–í—ã–π—Ç–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã">–í—ã–π—Ç–∏</a>
        </div>
      </div>
    </div>
  </div>
</header>

    <div class="content">
      <div class="container">
        <div class="content_inner">
          <div class="menu">
            <div class="class-switch">
              <button class="switch-btn active" data-href="lesson1.html">
                5 –∫–ª–∞—Å—Å
              </button>
              <button class="switch-btn" data-href="2lesson.html">
                6 –∫–ª–∞—Å—Å
              </button>
            </div>
            <ul class="lesson-list">
              <li data-href="lesson0.html">–í–≤–µ–¥–µ–Ω–∏–µ</li>
              <li data-href="lesson1.html">
                –£—Ä–æ–∫ 1. –ë–∞–∑–æ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –≤ –∫–∞–±–∏–Ω–µ—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∏
              </li>
              <li data-href="lesson2.html">–£—Ä–æ–∫ 2. –≠—Ä–≥–æ–Ω–æ–º–∏–∫–∞</li>
              <li data-href="lesson3.html">
                –£—Ä–æ–∫ 3. –ö–∏–±–µ—Ä-–≥–∏–≥–∏–µ–Ω–∞ –∏ –∑–∞—â–∏—Ç–∞ –ª–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
              </li>
              <li data-href="lesson4.html">
                –£—Ä–æ–∫ 4. –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ–º–ø—å—é—Ç–µ—Ä—ã: –ê–ø–ø–∞—Ä–∞—Ç–Ω–æ–µ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ
              </li>
              <li data-href="lesson5.html">
                –£—Ä–æ–∫ 5. –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ–º–ø—å—é—Ç–µ—Ä—ã: –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ
              </li>
              <li data-href="lesson6.html" class="active">–£—Ä–æ–∫ 6. –ê–ª–≥–æ—Ä–∏—Ç–º—ã</li>
            </ul>
          </div>

          <div class="content_games">
            <div class="algorithm-builder">
              <h2>üß© –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤</h2>
              <p>
                –°–æ–∑–¥–∞–π –∞–ª–≥–æ—Ä–∏—Ç–º "–ö–∞–∫ –ø—Ä–∏–≥–æ—Ç–æ–≤–∏—Ç—å —á–∞–π", –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞—è —à–∞–≥–∏ –≤
                –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ!
              </p>

              <div class="algorithm-workspace">
                <div class="steps-bank">
                  <h3>üì¶ –î–æ—Å—Ç—É–ø–Ω—ã–µ —à–∞–≥–∏:</h3>
                  <div class="draggable-steps" id="stepsBank">
                    <div
                      class="step-card"
                      draggable="true"
                      data-step="1"
                      data-original="true"
                    >
                      <span class="step-icon">üíß</span>
                      <span class="step-text">–ù–∞–ª–∏—Ç—å –≤–æ–¥—É –≤ —á–∞–π–Ω–∏–∫</span>
                    </div>
                    <div
                      class="step-card"
                      draggable="true"
                      data-step="2"
                      data-original="true"
                    >
                      <span class="step-icon">üî•</span>
                      <span class="step-text">–í–∫–ª—é—á–∏—Ç—å —á–∞–π–Ω–∏–∫</span>
                    </div>
                    <div
                      class="step-card"
                      draggable="true"
                      data-step="3"
                      data-original="true"
                    >
                      <span class="step-icon">‚òï</span>
                      <span class="step-text"
                        >–ü–æ–ª–æ–∂–∏—Ç—å —á–∞–π–Ω—ã–π –ø–∞–∫–µ—Ç–∏–∫ –≤ —á–∞—à–∫—É</span
                      >
                    </div>
                    <div
                      class="step-card"
                      draggable="true"
                      data-step="4"
                      data-original="true"
                    >
                      <span class="step-icon">‚è∞</span>
                      <span class="step-text">–î–æ–∂–¥–∞—Ç—å—Å—è –∑–∞–∫–∏–ø–∞–Ω–∏—è –≤–æ–¥—ã</span>
                    </div>
                    <div
                      class="step-card"
                      draggable="true"
                      data-step="5"
                      data-original="true"
                    >
                      <span class="step-icon">üåä</span>
                      <span class="step-text">–ó–∞–ª–∏—Ç—å –∫–∏–ø—è—Ç–∫–æ–º —á–∞—à–∫—É</span>
                    </div>
                    <div
                      class="step-card"
                      draggable="true"
                      data-step="6"
                      data-original="true"
                    >
                      <span class="step-icon">‚åõ</span>
                      <span class="step-text">–ù–∞—Å—Ç–æ—è—Ç—å —á–∞–π 3-5 –º–∏–Ω—É—Ç</span>
                    </div>
                    <div
                      class="step-card"
                      draggable="true"
                      data-step="7"
                      data-original="true"
                    >
                      <span class="step-icon">üóëÔ∏è</span>
                      <span class="step-text">–£–±—Ä–∞—Ç—å —á–∞–π–Ω—ã–π –ø–∞–∫–µ—Ç–∏–∫</span>
                    </div>
                  </div>
                </div>

                <div class="algorithm-sequence">
                  <h3>üìã –¢–≤–æ–π –∞–ª–≥–æ—Ä–∏—Ç–º:</h3>
                  <div class="drop-zone" id="algorithmZone">
                    <div class="empty-message" id="emptyMessage">
                      –ü–µ—Ä–µ—Ç–∞—â–∏ —Å—é–¥–∞ —à–∞–≥–∏ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ
                    </div>
                    <!-- –ó–¥–µ—Å—å –±—É–¥—É—Ç –ø–æ—è–≤–ª—è—Ç—å—Å—è —à–∞–≥–∏ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ -->
                  </div>
                  <div class="algorithm-controls">
                    <button id="checkAlgorithm" class="check-btn" disabled>
                      –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–ª–≥–æ—Ä–∏—Ç–º
                    </button>
                    <button id="clearAlgorithm" class="clear-btn">
                      –û—á–∏—Å—Ç–∏—Ç—å
                    </button>
                    <button
                      id="tryAgainBtn"
                      class="try-again-btn"
                      style="display: none"
                    >
                      –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –µ—â–µ —Ä–∞–∑
                    </button>
                  </div>
                </div>
              </div>

              <div
                class="algorithm-result"
                id="algorithmResult"
                style="display: none"
              >
                <div class="result-content">
                  <h3 id="resultTitle">–†–µ–∑—É–ª—å—Ç–∞—Ç</h3>
                  <p id="resultMessage">–°–æ–æ–±—â–µ–Ω–∏–µ</p>
                  <div id="resultDetails"></div>
                </div>
              </div>
            </div>

            <img
              src="images/arrow.png"
              alt="–î–∞–ª–µ–µ"
              class="arrow"
              id="next-arrow"
              style="display: none"
            />
            <img
              src="images/arrow.png"
              alt="–ù–∞–∑–∞–¥"
              class="arrow-back"
              id="back-arrow"
              title="–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ"
            />
          </div>
        </div>
      </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã—Ö–æ–¥–∞ -->
    <div id="logoutModal" class="logout-modal" style="display: none">
      <div class="logout-modal-content">
        <h3>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤—ã—Ö–æ–¥–∞</h3>
        <p>–í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã?</p>
        <div class="logout-modal-buttons">
          <button id="confirmLogout" class="logout-confirm-btn">
            –î–∞, –≤—ã–π—Ç–∏
          </button>
          <button id="cancelLogout" class="logout-cancel-btn">–û—Ç–º–µ–Ω–∞</button>
        </div>
      </div>
    </div>
    <div id="logoutOverlay" class="logout-overlay" style="display: none"></div>

    <!-- Modal for tooltips -->
    <div id="tooltipOverlay" class="tooltip-overlay"></div>
    <div id="tooltipModal" class="tooltip-modal"></div>

    <style>
      .algorithm-builder {
        padding: 30px;
        background: linear-gradient(135deg, #f8f9fa, #e9ecef);
        border-radius: 20px;
        margin: 20px;
      }

      .algorithm-builder h2 {
        color: #4d36db;
        text-align: center;
        margin-bottom: 10px;
        font-size: 28px;
      }

      .algorithm-builder > p {
        text-align: center;
        color: #666;
        margin-bottom: 30px;
        font-size: 16px;
      }

      .algorithm-workspace {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
        margin-bottom: 30px;
      }

      .steps-bank,
      .algorithm-sequence {
        background: white;
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      .steps-bank h3,
      .algorithm-sequence h3 {
        color: #4d36db;
        margin-bottom: 15px;
        font-size: 18px;
      }

      .draggable-steps {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .step-card {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px;
        background: #f8f9fa;
        border: 2px solid #e9ecef;
        border-radius: 10px;
        cursor: grab;
        transition: all 0.3s ease;
        user-select: none;
        position: relative;
      }

      .step-card:hover {
        border-color: #4d36db;
        background: #e8f0fe;
        transform: translateY(-2px);
      }

      .step-card:active {
        cursor: grabbing;
      }

      .step-card.dragging {
        opacity: 0.5;
        transform: rotate(2deg) scale(1.05);
        z-index: 1000;
      }

      .step-card[data-original='false'] {
        background: #e8f5e8;
        border-color: #28a745;
      }

      .step-icon {
        font-size: 20px;
        flex-shrink: 0;
      }

      .step-text {
        font-weight: 500;
        color: #333;
        flex: 1;
      }

      .drop-zone {
        min-height: 350px;
        border: 2px dashed #ddd;
        border-radius: 10px;
        padding: 15px;
        position: relative;
      }

      .drop-zone.drag-over {
        border-color: #4d36db;
        background: #e8f0fe;
      }

      .empty-message {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: #999;
        text-align: center;
        font-style: italic;
        pointer-events: none;
      }

      .algorithm-step {
        margin-bottom: 8px;
        position: relative;
        background: #e8f5e8;
        border: 2px solid #28a745;
      }

      .algorithm-step::before {
        content: counter(step-counter);
        counter-increment: step-counter;
        position: absolute;
        left: -25px;
        top: 50%;
        transform: translateY(-50%);
        background: #4d36db;
        color: white;
        border-radius: 50%;
        width: 22px;
        height: 22px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        font-weight: bold;
      }

      .drop-zone {
        counter-reset: step-counter;
      }

      .remove-step-btn {
        position: absolute;
        top: -8px;
        right: -8px;
        background: #dc3545;
        color: white;
        border: none;
        border-radius: 50%;
        width: 24px;
        height: 24px;
        font-size: 12px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
      }

      .remove-step-btn:hover {
        background: #c82333;
        transform: scale(1.1);
      }

      .algorithm-controls {
        margin-top: 20px;
        display: flex;
        gap: 10px;
        justify-content: center;
        flex-wrap: wrap;
      }

      .check-btn,
      .clear-btn,
      .try-again-btn {
        padding: 12px 24px;
        border: none;
        border-radius: 8px;
        font-family: 'Montserrat', sans-serif;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .check-btn {
        background: linear-gradient(135deg, #28a745, #20c997);
        color: white;
      }

      .check-btn:disabled {
        background: #e9ecef;
        color: #6c757d;
        cursor: not-allowed;
      }

      .check-btn:not(:disabled):hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
      }

      .clear-btn {
        background: #f8f9fa;
        color: #6c757d;
        border: 2px solid #dee2e6;
      }

      .clear-btn:hover {
        background: #e9ecef;
        transform: translateY(-2px);
      }

      .try-again-btn {
        background: linear-gradient(135deg, #ffc107, #ffca2c);
        color: #212529;
      }

      .try-again-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(255, 193, 7, 0.3);
      }

      .algorithm-result {
        background: white;
        padding: 25px;
        border-radius: 15px;
        text-align: center;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        animation: resultSlideIn 0.5s ease-out;
      }

      @keyframes resultSlideIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .algorithm-result.success {
        background: linear-gradient(135deg, #d4edda, #c3e6cb);
        border: 2px solid #28a745;
      }

      .algorithm-result.error {
        background: linear-gradient(135deg, #f8d7da, #f5c6cb);
        border: 2px solid #dc3545;
      }

      .result-content h3 {
        margin-bottom: 10px;
        font-size: 22px;
      }

      .result-content p {
        margin-bottom: 15px;
        font-size: 16px;
      }

      #resultDetails {
        text-align: left;
        background: rgba(255, 255, 255, 0.7);
        padding: 15px;
        border-radius: 8px;
        margin-top: 15px;
      }

      #resultDetails ol {
        padding-left: 20px;
      }

      #resultDetails li {
        margin: 8px 0;
        padding: 5px;
        border-radius: 5px;
      }

      /* –°—Ç–∏–ª–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ */
      .logout-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.6);
        z-index: 9999;
      }

      .logout-modal {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        border-radius: 15px;
        padding: 30px;
        z-index: 10000;
        max-width: 400px;
        width: 90%;
        text-align: center;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        border: 3px solid #4d36db;
      }

      .logout-modal h3 {
        color: #4d36db;
        margin-bottom: 15px;
        font-size: 20px;
        font-weight: 600;
      }

      .logout-modal p {
        color: #666;
        margin-bottom: 25px;
        font-size: 16px;
        line-height: 1.5;
      }

      .logout-modal-buttons {
        display: flex;
        gap: 15px;
        justify-content: center;
      }

      .logout-confirm-btn,
      .logout-cancel-btn {
        padding: 12px 20px;
        border: none;
        border-radius: 8px;
        font-family: 'Montserrat', sans-serif;
        font-weight: 600;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.3s ease;
        min-width: 100px;
      }

      .logout-confirm-btn {
        background: linear-gradient(135deg, #dc3545, #c82333);
        color: white;
      }

      .logout-confirm-btn:hover {
        background: linear-gradient(135deg, #c82333, #a71e2a);
        transform: translateY(-2px);
      }

      .logout-cancel-btn {
        background: #f8f9fa;
        color: #4d36db;
        border: 2px solid #4d36db;
      }

      .logout-cancel-btn:hover {
        background: #e9ecef;
        transform: translateY(-2px);
      }

      .iconexit {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 40px;
        height: 40px;
        background-color: #f0f0f0;
        border-radius: 50%;
        cursor: pointer;
        font-size: 18px;
        transition: all 0.3s ease;
        text-decoration: none;
        border: 2px solid transparent;
      }

      .iconexit:hover {
        background-color: #dc3545;
        color: white;
        border-color: #dc3545;
        transform: scale(1.1);
      }

      .nameuser {
        font-weight: 600;
        color: #4d36db;
        margin-right: 15px;
        font-size: 16px;
      }

      .nameuser.loading {
        color: #999;
        animation: pulse 1.5s ease-in-out infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
      }

      @media (max-width: 768px) {
        .algorithm-workspace {
          grid-template-columns: 1fr;
          gap: 20px;
        }

        .algorithm-builder {
          padding: 20px;
          margin: 10px;
        }

        .step-card {
          padding: 10px;
          gap: 8px;
        }

        .step-icon {
          font-size: 18px;
        }

        .step-text {
          font-size: 14px;
        }

        .algorithm-controls {
          flex-direction: column;
          align-items: center;
        }

        .check-btn,
        .clear-btn,
        .try-again-btn {
          width: 100%;
          max-width: 200px;
        }
      }
    </style>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="js/slick.min.js"></script>
    <script src="js/jquery.fancybox.min.js"></script>
    <script src="js/help.js"></script>
    <script src="js/main.js"></script>

    <script>
      document.addEventListener('DOMContentLoaded', function () {
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        if (!requireAuth()) return;

        const currentUser = getCurrentUser();
        if (currentUser) {
          document.getElementById('userName').textContent = currentUser.name;
          document.getElementById('userName').classList.remove('loading');
        } else {
          logout();
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–Ω–æ–ø–∫–∏ –≤—ã—Ö–æ–¥–∞
        const logoutBtn = document.getElementById('logoutBtn');
        const logoutModal = document.getElementById('logoutModal');
        const logoutOverlay = document.getElementById('logoutOverlay');
        const confirmLogout = document.getElementById('confirmLogout');
        const cancelLogout = document.getElementById('cancelLogout');

        logoutBtn.addEventListener('click', function (e) {
          e.preventDefault();
          logoutModal.style.display = 'block';
          logoutOverlay.style.display = 'block';
        });

        confirmLogout.addEventListener('click', function () {
          confirmLogout.textContent = '–í—ã—Ö–æ–¥–∏–º...';
          confirmLogout.disabled = true;
          setTimeout(() => logout(), 500);
        });

        function hideLogoutModal() {
          logoutModal.style.display = 'none';
          logoutOverlay.style.display = 'none';
          confirmLogout.textContent = '–î–∞, –≤—ã–π—Ç–∏';
          confirmLogout.disabled = false;
        }

        cancelLogout.addEventListener('click', hideLogoutModal);
        logoutOverlay.addEventListener('click', hideLogoutModal);

        // –û–°–ù–û–í–ù–ê–Ø –õ–û–ì–ò–ö–ê –ö–û–ù–°–¢–†–£–ö–¢–û–†–ê –ê–õ–ì–û–†–ò–¢–ú–û–í
        const correctOrder = [1, 3, 2, 4, 5, 6, 7]; // –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å
        let algorithmSteps = [];
        let draggedElement = null;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è drag & drop
        initializeDragAndDrop();

        function initializeDragAndDrop() {
          const stepCards = document.querySelectorAll('.step-card');
          const dropZone = document.getElementById('algorithmZone');

          stepCards.forEach(card => {
            card.addEventListener('dragstart', handleDragStart);
            card.addEventListener('dragend', handleDragEnd);
          });

          dropZone.addEventListener('dragover', handleDragOver);
          dropZone.addEventListener('drop', handleDrop);
          dropZone.addEventListener('dragenter', handleDragEnter);
          dropZone.addEventListener('dragleave', handleDragLeave);
        }

        function handleDragStart(e) {
          draggedElement = this;
          this.classList.add('dragging');
          e.dataTransfer.effectAllowed = 'move';
          e.dataTransfer.setData('text/html', this.outerHTML);
          e.dataTransfer.setData('text/plain', this.dataset.step);
        }

        function handleDragEnd(e) {
          this.classList.remove('dragging');
          draggedElement = null;
        }

        function handleDragOver(e) {
          e.preventDefault();
          e.dataTransfer.dropEffect = 'move';

          // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏
          const afterElement = getDragAfterElement(e.clientY);
          const dropZone = document.getElementById('algorithmZone');

          if (afterElement == null) {
            dropZone.appendChild(createDropIndicator());
          } else {
            dropZone.insertBefore(createDropIndicator(), afterElement);
          }
        }

        function handleDragEnter(e) {
          e.preventDefault();
          this.classList.add('drag-over');
        }

        function handleDragLeave(e) {
          if (!this.contains(e.relatedTarget)) {
            this.classList.remove('drag-over');
            removeDropIndicators();
          }
        }

        function handleDrop(e) {
          e.preventDefault();
          this.classList.remove('drag-over');
          removeDropIndicators();

          const stepId = e.dataTransfer.getData('text/plain');
          const afterElement = getDragAfterElement(e.clientY);

          if (draggedElement && draggedElement.dataset.original === 'true') {
            // –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ –∏–∑ –±–∞–Ω–∫–∞ —à–∞–≥–æ–≤
            addStepToAlgorithm(stepId, afterElement);
          } else if (
            draggedElement &&
            draggedElement.dataset.original === 'false'
          ) {
            // –ü–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤–Ω—É—Ç—Ä–∏ –∞–ª–≥–æ—Ä–∏—Ç–º–∞
            reorderStepInAlgorithm(draggedElement, afterElement);
          }
        }

        function getDragAfterElement(y) {
          const dropZone = document.getElementById('algorithmZone');
          const draggableElements = [
            ...dropZone.querySelectorAll('.algorithm-step:not(.dragging)'),
          ];

          return draggableElements.reduce(
            (closest, child) => {
              const box = child.getBoundingClientRect();
              const offset = y - box.top - box.height / 2;

              if (offset < 0 && offset > closest.offset) {
                return { offset: offset, element: child };
              } else {
                return closest;
              }
            },
            { offset: Number.NEGATIVE_INFINITY }
          ).element;
        }

        function createDropIndicator() {
          removeDropIndicators();
          const indicator = document.createElement('div');
          indicator.className = 'drop-indicator';
          indicator.style.cssText = `
            height: 2px;
            background: #4d36db;
            margin: 5px 0;
            border-radius: 1px;
            opacity: 0.8;
          `;
          return indicator;
        }

        function removeDropIndicators() {
          document.querySelectorAll('.drop-indicator').forEach(indicator => {
            indicator.remove();
          });
        }

        function addStepToAlgorithm(stepId, afterElement) {
          const dropZone = document.getElementById('algorithmZone');
          const emptyMessage = document.getElementById('emptyMessage');

          // –°–∫—Ä—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –ø—É—Å—Ç–æ—Ç–µ
          if (emptyMessage) {
            emptyMessage.style.display = 'none';
          }

          // –°–æ–∑–¥–∞–µ–º –∫–æ–ø–∏—é —ç–ª–µ–º–µ–Ω—Ç–∞ –¥–ª—è –∞–ª–≥–æ—Ä–∏—Ç–º–∞
          const originalStep = document.querySelector(
            `.step-card[data-step="${stepId}"][data-original="true"]`
          );
          const algorithmStep = originalStep.cloneNode(true);

          algorithmStep.dataset.original = 'false';
          algorithmStep.className = 'step-card algorithm-step';
          algorithmStep.draggable = true;

          // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É —É–¥–∞–ª–µ–Ω–∏—è
          const removeBtn = document.createElement('button');
          removeBtn.innerHTML = '‚úï';
          removeBtn.className = 'remove-step-btn';
          removeBtn.addEventListener('click', () =>
            removeStepFromAlgorithm(algorithmStep, stepId)
          );
          algorithmStep.appendChild(removeBtn);

          // –í—Å—Ç–∞–≤–ª—è–µ–º –≤ –Ω—É–∂–Ω–æ–µ –º–µ—Å—Ç–æ
          if (afterElement) {
            dropZone.insertBefore(algorithmStep, afterElement);
          } else {
            dropZone.appendChild(algorithmStep);
          }

          // –°–∫—Ä—ã–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —à–∞–≥
          originalStep.style.display = 'none';

          // –û–±–Ω–æ–≤–ª—è–µ–º –º–∞—Å—Å–∏–≤ —à–∞–≥–æ–≤
          updateAlgorithmSteps();
          updateCheckButton();

          // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º drag & drop –¥–ª—è –Ω–æ–≤–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
          algorithmStep.addEventListener('dragstart', handleDragStart);
          algorithmStep.addEventListener('dragend', handleDragEnd);
        }

        function reorderStepInAlgorithm(draggedStep, afterElement) {
          const dropZone = document.getElementById('algorithmZone');

          if (afterElement) {
            dropZone.insertBefore(draggedStep, afterElement);
          } else {
            dropZone.appendChild(draggedStep);
          }

          updateAlgorithmSteps();
        }

        function removeStepFromAlgorithm(stepElement, stepId) {
          stepElement.remove();

          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —à–∞–≥
          const originalStep = document.querySelector(
            `.step-card[data-step="${stepId}"][data-original="true"]`
          );
          if (originalStep) {
            originalStep.style.display = 'flex';
          }

          updateAlgorithmSteps();
          updateCheckButton();

          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—É—Å—Ç–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –µ—Å–ª–∏ –Ω–µ—Ç —à–∞–≥–æ–≤
          const dropZone = document.getElementById('algorithmZone');
          const emptyMessage = document.getElementById('emptyMessage');
          if (
            dropZone.querySelectorAll('.algorithm-step').length === 0 &&
            emptyMessage
          ) {
            emptyMessage.style.display = 'block';
          }
        }

        function updateAlgorithmSteps() {
          const dropZone = document.getElementById('algorithmZone');
          const stepElements = dropZone.querySelectorAll('.algorithm-step');

          algorithmSteps = [];
          stepElements.forEach(element => {
            algorithmSteps.push(parseInt(element.dataset.step));
          });
        }

        function updateCheckButton() {
          const checkBtn = document.getElementById('checkAlgorithm');
          checkBtn.disabled = algorithmSteps.length === 0;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–ª–≥–æ—Ä–∏—Ç–º–∞
        document
          .getElementById('checkAlgorithm')
          .addEventListener('click', checkAlgorithm);

        function checkAlgorithm() {
          const resultDiv = document.getElementById('algorithmResult');
          const isCorrect =
            JSON.stringify(algorithmSteps) === JSON.stringify(correctOrder);

          if (isCorrect) {
            showResult(
              true,
              'üéâ –û—Ç–ª–∏—á–Ω–æ!',
              '–¢—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å–æ—Å—Ç–∞–≤–∏–ª –∞–ª–≥–æ—Ä–∏—Ç–º –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è —á–∞—è! –¢–µ–ø–µ—Ä—å —Ç—ã –ø–æ–Ω–∏–º–∞–µ—à—å, –∫–∞–∫ –≤–∞–∂–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —à–∞–≥–æ–≤.'
            );
            document.getElementById('next-arrow').style.display = 'block';
            document.getElementById('tryAgainBtn').style.display = 'none';
          } else {
            showResult(
              false,
              'ü§î –ü–æ—á—Ç–∏ –ø–æ–ª—É—á–∏–ª–æ—Å—å!',
              '–ê–ª–≥–æ—Ä–∏—Ç–º —Å–æ—Å—Ç–∞–≤–ª–µ–Ω –Ω–µ —Å–æ–≤—Å–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω–æ. –ü–æ–¥—É–º–∞–π –æ –ª–æ–≥–∏—á–µ—Å–∫–æ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏: —á—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —Å–Ω–∞—á–∞–ª–∞, –∞ —á—Ç–æ –ø–æ—Ç–æ–º?'
            );
            document.getElementById('tryAgainBtn').style.display =
              'inline-block';
          }

          resultDiv.style.display = 'block';
          resultDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        function showResult(isSuccess, title, message) {
          const resultDiv = document.getElementById('algorithmResult');
          const resultTitle = document.getElementById('resultTitle');
          const resultMessage = document.getElementById('resultMessage');
          const resultDetails = document.getElementById('resultDetails');

          resultDiv.className = `algorithm-result ${
            isSuccess ? 'success' : 'error'
          }`;
          resultTitle.textContent = title;
          resultMessage.textContent = message;

          if (!isSuccess) {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≥–¥–µ –æ—à–∏–±–∫–∏ –∏ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å
            let detailsHTML = '<h4>üîç –°—Ä–∞–≤–Ω–∏ —Å–≤–æ–π –∞–ª–≥–æ—Ä–∏—Ç–º —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º:</h4>';

            detailsHTML +=
              '<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 15px 0;">';

            // –¢–≤–æ–π –∞–ª–≥–æ—Ä–∏—Ç–º
            detailsHTML +=
              '<div><h5 style="color: #dc3545;">‚ùå –¢–≤–æ–π –∞–ª–≥–æ—Ä–∏—Ç–º:</h5><ol>';
            algorithmSteps.forEach((stepId, index) => {
              const stepText = getStepText(stepId);
              const isCorrectPosition = correctOrder[index] === stepId;
              detailsHTML += `<li style="color: ${
                isCorrectPosition ? '#28a745' : '#dc3545'
              }; margin: 5px 0;">${stepText}</li>`;
            });
            detailsHTML += '</ol></div>';

            // –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º
            detailsHTML +=
              '<div><h5 style="color: #28a745;">‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º:</h5><ol>';
            correctOrder.forEach(stepId => {
              const stepText = getStepText(stepId);
              detailsHTML += `<li style="color: #28a745; margin: 5px 0;">${stepText}</li>`;
            });
            detailsHTML += '</ol></div>';

            detailsHTML += '</div>';
            detailsHTML +=
              '<p style="margin-top: 15px; padding: 10px; background: rgba(255,255,255,0.8); border-radius: 8px;"><strong>üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞:</strong> –ü–æ–¥—É–º–∞–π –æ —Ç–æ–º, —á—Ç–æ –Ω—É–∂–Ω–æ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Å–Ω–∞—á–∞–ª–∞, –∞ —á—Ç–æ –¥–µ–ª–∞—Ç—å –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è.</p>';

            resultDetails.innerHTML = detailsHTML;
          } else {
            resultDetails.innerHTML = `
              <div style="background: rgba(255,255,255,0.8); padding: 15px; border-radius: 8px;">
                <p><strong>üéØ –û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞!</strong> –¢—ã –æ—Å–≤–æ–∏–ª –æ—Å–Ω–æ–≤—ã —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤:</p>
                <ul style="text-align: left; margin: 10px 0; padding-left: 20px;">
                  <li>‚úÖ –û–ø—Ä–µ–¥–µ–ª–∏–ª –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —à–∞–≥–∏</li>
                  <li>‚úÖ –†–∞–∑–º–µ—Å—Ç–∏–ª –∏—Ö –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ</li>
                  <li>‚úÖ –°–æ–∑–¥–∞–ª —Ä–∞–±–æ—Ç–∞—é—â–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º</li>
                </ul>
                <p>–¢–µ–ø–µ—Ä—å —Ç—ã –º–æ–∂–µ—à—å –ø—Ä–∏–º–µ–Ω—è—Ç—å —ç—Ç–∏ –Ω–∞–≤—ã–∫–∏ –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –¥—Ä—É–≥–∏—Ö –∑–∞–¥–∞—á!</p>
              </div>
            `;
          }
        }

        function getStepText(stepId) {
          const stepTexts = {
            1: 'üíß –ù–∞–ª–∏—Ç—å –≤–æ–¥—É –≤ —á–∞–π–Ω–∏–∫',
            2: '‚òï –ü–æ–ª–æ–∂–∏—Ç—å —á–∞–π–Ω—ã–π –ø–∞–∫–µ—Ç–∏–∫ –≤ —á–∞—à–∫—É',
            3: 'üî• –í–∫–ª—é—á–∏—Ç—å —á–∞–π–Ω–∏–∫',
            4: '‚è∞ –î–æ–∂–¥–∞—Ç—å—Å—è –∑–∞–∫–∏–ø–∞–Ω–∏—è –≤–æ–¥—ã',
            5: 'üåä –ó–∞–ª–∏—Ç—å –∫–∏–ø—è—Ç–∫–æ–º —á–∞—à–∫—É',
            6: '‚åõ –ù–∞—Å—Ç–æ—è—Ç—å —á–∞–π 3-5 –º–∏–Ω—É—Ç',
            7: 'üóëÔ∏è –£–±—Ä–∞—Ç—å —á–∞–π–Ω—ã–π –ø–∞–∫–µ—Ç–∏–∫',
          };
          return stepTexts[stepId] || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —à–∞–≥';
        }

        // –ö–Ω–æ–ø–∫–∞ "–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –µ—â–µ —Ä–∞–∑"
        document
          .getElementById('tryAgainBtn')
          .addEventListener('click', function () {
            document.getElementById('algorithmResult').style.display = 'none';
            document.getElementById('tryAgainBtn').style.display = 'none';

            // –§–æ–∫—É—Å –Ω–∞ –æ–±–ª–∞—Å—Ç—å –∞–ª–≥–æ—Ä–∏—Ç–º–∞
            document.getElementById('algorithmZone').scrollIntoView({
              behavior: 'smooth',
              block: 'center',
            });

            // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –æ–±–ª–∞—Å—Ç–∏ –¥–ª—è –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è –≤–Ω–∏–º–∞–Ω–∏—è
            const dropZone = document.getElementById('algorithmZone');
            dropZone.style.border = '3px solid #ffc107';
            dropZone.style.background = '#fff3cd';

            setTimeout(() => {
              dropZone.style.border = '2px dashed #ddd';
              dropZone.style.background = 'transparent';
            }, 2000);
          });

        // –û—á–∏—Å—Ç–∫–∞ –∞–ª–≥–æ—Ä–∏—Ç–º–∞
        document
          .getElementById('clearAlgorithm')
          .addEventListener('click', clearAlgorithm);

        function clearAlgorithm() {
          const dropZone = document.getElementById('algorithmZone');
          const algorithmStepElements =
            dropZone.querySelectorAll('.algorithm-step');

          // –£–¥–∞–ª—è–µ–º –≤—Å–µ —à–∞–≥–∏ –∏–∑ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∏—Ö –≤ –±–∞–Ω–∫
          algorithmStepElements.forEach(stepElement => {
            const stepId = stepElement.dataset.step;
            const originalStep = document.querySelector(
              `.step-card[data-step="${stepId}"][data-original="true"]`
            );
            if (originalStep) {
              originalStep.style.display = 'flex';
            }
            stepElement.remove();
          });

          // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
          algorithmSteps = [];
          document.getElementById('emptyMessage').style.display = 'block';
          document.getElementById('algorithmResult').style.display = 'none';
          document.getElementById('tryAgainBtn').style.display = 'none';
          document.getElementById('next-arrow').style.display = 'none';
          updateCheckButton();

          console.log('–ê–ª–≥–æ—Ä–∏—Ç–º –æ—á–∏—â–µ–Ω, –≤—Å–µ —à–∞–≥–∏ –≤–æ–∑–≤—Ä–∞—â–µ–Ω—ã –≤ –±–∞–Ω–∫');
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å—Ç—Ä–µ–ª–∫–∏ "–î–∞–ª–µ–µ"
        document
          .getElementById('next-arrow')
          .addEventListener('click', function () {
            // –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —É—Ä–æ–∫—É –∏–ª–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—é –∫—É—Ä—Å–∞
            alert(
              '–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –¢—ã –∑–∞–≤–µ—Ä—à–∏–ª –∏–∑—É—á–µ–Ω–∏–µ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤. –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —Ä–∞–∑–¥–µ–ª—É...'
            );
            // window.location.href = 'next-lesson.html';
          });

        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è UX

        // –ü–æ–¥—Å–∫–∞–∑–∫–∏ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏
        const stepCards = document.querySelectorAll(
          '.step-card[data-original="true"]'
        );
        stepCards.forEach(card => {
          card.addEventListener('mouseenter', function () {
            this.style.transform = 'translateY(-3px) scale(1.02)';
            this.style.boxShadow = '0 6px 20px rgba(77, 54, 219, 0.2)';
          });

          card.addEventListener('mouseleave', function () {
            this.style.transform = '';
            this.style.boxShadow = '';
          });
        });

        // –ó–≤—É–∫–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
        function playSound(type) {
          // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∑–≤—É–∫–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è UX
          // const audio = new Audio(`sounds/${type}.mp3`);
          // audio.play().catch(() => {}); // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
        }

        // –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —à–∞–≥–∞
        function animateStepAddition(element) {
          element.style.transform = 'scale(0.8)';
          element.style.opacity = '0';

          setTimeout(() => {
            element.style.transition = 'all 0.3s ease';
            element.style.transform = 'scale(1)';
            element.style.opacity = '1';
          }, 50);
        }

        // –ü–æ–¥—Å—á–µ—Ç –ø–æ–ø—ã—Ç–æ–∫ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
        let attemptCount = 0;

        const originalCheckAlgorithm =
          document.getElementById('checkAlgorithm').onclick;
        document
          .getElementById('checkAlgorithm')
          .addEventListener('click', function () {
            attemptCount++;
            console.log(
              `–ü–æ–ø—ã—Ç–∫–∞ ‚Ññ${attemptCount}, —à–∞–≥–æ–≤ –≤ –∞–ª–≥–æ—Ä–∏—Ç–º–µ: ${algorithmSteps.length}`
            );
          });

        // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ (–≤ localStorage)
        function saveProgress() {
          const progress = {
            algorithmSteps: algorithmSteps,
            attemptCount: attemptCount,
            completed:
              document.getElementById('next-arrow').style.display === 'block',
          };
          localStorage.setItem(
            'algorithm_builder_progress',
            JSON.stringify(progress)
          );
        }

        function loadProgress() {
          const saved = localStorage.getItem('algorithm_builder_progress');
          if (saved) {
            const progress = JSON.parse(saved);
            console.log('–ó–∞–≥—Ä—É–∂–µ–Ω –ø—Ä–æ–≥—Ä–µ—Å—Å:', progress);
            // –ú–æ–∂–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
          }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        loadProgress();
        console.log('üß© –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
        console.log('‚ú® –í—Å–µ —Å–∏—Å—Ç–µ–º—ã –≥–æ—Ç–æ–≤—ã –∫ —Ä–∞–±–æ—Ç–µ!');
      });

      // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
      window.logout = logout;
      window.getCurrentUser = getCurrentUser;
      window.requireAuth = requireAuth;
    </script>
    <script src="js/video-modal.js"></script>
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –≤–∏–¥–µ–æ-–ø–ª–µ–µ—Ä -->
    <script src="js/main.js"></script>

    <script>
      // –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è –≤–∏–¥–µ–æ-–ø–ª–µ–µ—Ä–∞
      let videoModal = null;

      document.addEventListener('DOMContentLoaded', function () {
        console.log('üìö –£—Ä–æ–∫ 1 - —á–∞—Å—Ç—å 3 –∑–∞–≥—Ä—É–∂–µ–Ω');

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–∏–¥–µ–æ-–ø–ª–µ–µ—Ä–∞
        initVideoPlayer();

        console.log('‚úÖ –£—Ä–æ–∫ 1-3 —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
      });

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–∏–¥–µ–æ-–ø–ª–µ–µ—Ä–∞ –¥–ª—è —ç—Ç–æ–π —á–∞—Å—Ç–∏ —É—Ä–æ–∫–∞
      function initVideoPlayer() {
        if (typeof window.createVideoModal === 'function') {
          try {
            videoModal = window.createVideoModal({
              videoUrl: 'videos/IMG_5805.mp4', // –í–∏–¥–µ–æ –¥–ª—è —ç—Ç–æ–π —á–∞—Å—Ç–∏ —É—Ä–æ–∫–∞
              buttonTitle: '–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤–∏–¥–µ–æ —Å –∂–µ—Å—Ç–∞–º–∏ –ø–æ —É—Ä–æ–∫—É',
              buttonIcon: 'ü§ö',
              buttonPosition: 'top-right',
              autoplay: true,
              controls: true,
              loop: false,
            });

            console.log('üé• –í–∏–¥–µ–æ-–ø–ª–µ–µ—Ä –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è —É—Ä–æ–∫–∞ 1-3');
          } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤–∏–¥–µ–æ-–ø–ª–µ–µ—Ä–∞:', error);
          }
        } else {
          console.warn('‚ö†Ô∏è –ú–æ–¥—É–ª—å –≤–∏–¥–µ–æ-–ø–ª–µ–µ—Ä–∞ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
        }
      }

      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤–∏–¥–µ–æ (–º–æ–∂–µ—Ç –ø–æ–Ω–∞–¥–æ–±–∏—Ç—å—Å—è)
      window.updateLessonVideo = function (videoUrl, title, icon) {
        if (videoModal) {
          videoModal.updateVideo(videoUrl);
          videoModal.options.buttonTitle = title;
          videoModal.options.buttonIcon = icon;
        }
      };

      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–∫—Ä—ã—Ç–∏—è/–ø–æ–∫–∞–∑–∞ –≤–∏–¥–µ–æ –∫–Ω–æ–ø–∫–∏
      window.toggleVideoButton = function (show = true) {
        if (videoModal && videoModal.button) {
          videoModal.button.style.display = show ? 'flex' : 'none';
        }
      };

      // –û—á–∏—Å—Ç–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤ –ø—Ä–∏ —É—Ö–æ–¥–µ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
      window.addEventListener('beforeunload', function () {
        if (videoModal) {
          videoModal.destroy();
        }
      });
    </script>
  </body>
</html>
