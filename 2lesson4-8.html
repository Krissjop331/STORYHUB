<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>STORYHUB - 6 –∫–ª–∞—Å—Å: –®–µ—Å—Ç–Ω–∞–¥—Ü–∞—Ç–µ—Ä–∏—á–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞</title>
    <link rel="stylesheet" href="css/reset.css" />
    <link rel="stylesheet" href="css/slick.css" />
    <link rel="stylesheet" href="css/jquery.fancybox.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/header-ui.css" />
</head>

  <body>
    <script src="js/site-guard-header.js"></script>
    <!-- –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
    <script>
      const SessionUtils = {
        get: function (name) {
          try {
            return sessionStorage.getItem(name);
          } catch (error) {
            return null;
          }
        },
        remove: function (name) {
          try {
            sessionStorage.removeItem(name);
          } catch (error) {
            return false;
          }
        },
      };

      function validateSessionToken(token) {
        if (!token) return false;
        try {
          const tokenData = JSON.parse(atob(token));
          const sessionStart = SessionUtils.get('STORYHUB_session_start');
          return (
            tokenData.sessionId &&
            tokenData.username &&
            tokenData.createdAt &&
            sessionStart &&
            tokenData.createdAt >= sessionStart
          );
        } catch (error) {
          return false;
        }
      }

      function requireAuth() {
        const token = SessionUtils.get('STORYHUB_auth_token');
        const userData = SessionUtils.get('STORYHUB_user_data');
        if (!token || !userData || !validateSessionToken(token)) {
          SessionUtils.remove('STORYHUB_auth_token');
          SessionUtils.remove('STORYHUB_user_data');
          window.location.href = 'index.html';
          return false;
        }
        return true;
      }

      function getCurrentUser() {
        const token = SessionUtils.get('STORYHUB_auth_token');
        const userData = SessionUtils.get('STORYHUB_user_data');
        if (token && userData && validateSessionToken(token)) {
          try {
            return JSON.parse(userData);
          } catch (error) {
            return null;
          }
        }
        return null;
      }

      function logout() {
        SessionUtils.remove('STORYHUB_auth_token');
        SessionUtils.remove('STORYHUB_user_data');
        window.location.href = 'index.html';
      }

      if (!requireAuth()) {
        document.documentElement.style.display = 'none';
      }
    </script>

    <header class="header sg-header">
  <div class="container">
    <div class="header_inner">
      <a href="lesson0.html" class="logo">STORY<span>HUB</span></a>
      <div class="header-controls">
        <a href="#" class="admin-panel-btn" id="adminPanelBtn" style="display:none" title="–ü–∞–Ω–µ–ª—å">–ê–¥–º–∏–Ω–∫–∞</a>
        <div class="exit">
          <p class="nameuser" id="userName"></p>
          <a href="#" class="iconexit" id="logoutBtn" title="–í—ã–π—Ç–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã">–í—ã–π—Ç–∏</a>
        </div>
      </div>
    </div>
  </div>
</header>

    <div class="content">
      <div class="container">
        <div class="content_inner">
          <div class="menu">
            <div class="class-switch">
              <button class="switch-btn" data-href="lesson0.html">
                5 –∫–ª–∞—Å—Å
              </button>
              <button class="switch-btn active" data-href="2lesson.html">
                6 –∫–ª–∞—Å—Å
              </button>
            </div>

            <ul class="lesson-list">
              <li data-href="2lesson.html">
                –£—Ä–æ–∫ 1. –î–≤–æ–∏—á–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –≤ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞—Ö
              </li>
              <li data-href="2lesson2.html">–£—Ä–æ–∫ 2. –ë–∏—Ç –∏ –ë–∞–π—Ç</li>
              <li data-href="2lesson3.html">
                –£—Ä–æ–∫ 3. –î–µ—Å—è—Ç–∏—á–Ω–∞—è –∏ –¥–≤–æ–∏—á–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å—á–∏—Å–ª–µ–Ω–∏—è –∏ –∏—Ö
                –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ
              </li>
              <li data-href="2lesson4.html" class="active">
                –£—Ä–æ–∫ 4. –®–µ—Å—Ç–Ω–∞–¥—Ü–∞—Ç–µ—Ä–∏—á–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å—á–∏—Å–ª–µ–Ω–∏—è
              </li>
              <li data-href="2lesson5.html">
                –£—Ä–æ–∫ 5. –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ–º–ø—å—é—Ç–µ—Ä—ã: –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –∏ –∞–ø–ø–∞—Ä–∞—Ç–Ω–æ–µ
                –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ
              </li>
              <li data-href="2lesson6.html">
                –£—Ä–æ–∫ 6. –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ–º–ø—å—é—Ç–µ—Ä—ã ‚Äì –í–≤–æ–¥, –•—Ä–∞–Ω–µ–Ω–∏–µ, –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏
                –í—ã–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö
              </li>
            </ul>
          </div>

          <div class="content_games">
            <!-- –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∑–∞–¥–∞—á–∞ -->
            <div class="hex-challenge">
              <h3>üî¢ –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è –∑–∞–¥–∞—á–∞: 0xFFF –≤ –¥–µ—Å—è—Ç–∏—á–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ</h3>
              <p>–ò—Å–ø–æ–ª—å–∑—É–π —Ñ–æ—Ä–º—É–ª—É –¥–ª—è —Ç—Ä—ë—Ö–∑–Ω–∞—á–Ω–æ–≥–æ hex —á–∏—Å–ª–∞</p>

              <!-- –°–∏—Å—Ç–µ–º–∞ –ø–æ–¥—Å–∫–∞–∑–æ–∫ -->
              <div class="hint-system">
                <button id="toggleHints" class="hint-toggle-btn">
                  üí° –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫–∏
                </button>

                <div id="hintsPanel" class="hints-panel" style="display: none">
                  <div class="hints-header">
                    <h4>üß† –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫</h4>
                    <p>–í—ã–±–µ—Ä–∏ –Ω—É–∂–Ω—É—é –ø–æ–¥—Å–∫–∞–∑–∫—É:</p>
                  </div>

                  <div class="hint-buttons">
                    <button class="hint-btn" data-hint="basics">
                      üî§ –û—Å–Ω–æ–≤—ã HEX
                    </button>
                    <button class="hint-btn" data-hint="powers">
                      üî¢ –°—Ç–µ–ø–µ–Ω–∏ 16
                    </button>
                    <button class="hint-btn" data-hint="formula">
                      üìê –§–æ—Ä–º—É–ª–∞
                    </button>
                    <button class="hint-btn" data-hint="steps">
                      üë£ –ü–æ—à–∞–≥–æ–≤–æ
                    </button>
                    <button class="hint-btn" data-hint="calculator">
                      üßÆ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä
                    </button>
                  </div>

                  <div id="hintContent" class="hint-content">
                    <div class="hint-message">–í—ã–±–µ—Ä–∏ —Ç–∏–ø –ø–æ–¥—Å–∫–∞–∑–∫–∏ –≤—ã—à–µ üëÜ</div>
                  </div>
                </div>
              </div>

              <div class="hex-calculator">
                <h4>üßÆ –ü–æ—à–∞–≥–æ–≤—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä:</h4>

                <div class="calc-row">
                  <span class="label">F √ó 16¬≤ =</span>
                  <input type="number" id="step1" placeholder="?" />
                  <span class="check-mark" id="check1">‚úì</span>
                  <button
                    class="step-help-btn"
                    data-step="1"
                    title="–ü–æ–º–æ—â—å –ø–æ —à–∞–≥—É 1"
                  >
                    ‚ùì
                  </button>
                </div>

                <div class="calc-row">
                  <span class="label">F √ó 16¬π =</span>
                  <input type="number" id="step2" placeholder="?" />
                  <span class="check-mark" id="check2">‚úì</span>
                  <button
                    class="step-help-btn"
                    data-step="2"
                    title="–ü–æ–º–æ—â—å –ø–æ —à–∞–≥—É 2"
                  >
                    ‚ùì
                  </button>
                </div>

                <div class="calc-row">
                  <span class="label">F √ó 16‚Å∞ =</span>
                  <input type="number" id="step3" placeholder="?" />
                  <span class="check-mark" id="check3">‚úì</span>
                  <button
                    class="step-help-btn"
                    data-step="3"
                    title="–ü–æ–º–æ—â—å –ø–æ —à–∞–≥—É 3"
                  >
                    ‚ùì
                  </button>
                </div>

                <div class="calc-row final-row">
                  <span class="label">–ò—Ç–æ–≥–æ:</span>
                  <input type="number" id="finalAnswer" placeholder="?" />
                  <button id="checkFinal" class="check-final-btn">
                    –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
                  </button>
                  <button
                    class="step-help-btn"
                    data-step="final"
                    title="–ü–æ–º–æ—â—å —Å –∏—Ç–æ–≥–æ–º"
                  >
                    ‚ùì
                  </button>
                </div>
              </div>

              <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ -->
              <div class="dynamic-hints">
                <div class="hint-card" id="basicHints">
                  <div class="hint">üí° 16¬≤ = 256</div>
                  <div class="hint">üí° 16¬π = 16</div>
                  <div class="hint">üí° 16‚Å∞ = 1</div>
                  <div class="hint">üí° F = 15</div>
                </div>

                <div
                  class="smart-feedback"
                  id="smartFeedback"
                  style="display: none"
                >
                  <div class="feedback-content">
                    <div class="feedback-icon">ü§ñ</div>
                    <div class="feedback-text" id="feedbackText"></div>
                  </div>
                </div>
              </div>

              <div class="hex-result" id="calculatorResult"></div>
            </div>

            <img
              src="images/arrow.png"
              alt="–î–∞–ª–µ–µ"
              class="arrow"
              id="nextArrow"
              style="display: none"
            />
            <img
              src="images/arrow.png"
              alt="–ù–∞–∑–∞–¥"
              class="arrow-back"
              id="back-arrow"
              title="–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ"
            />
          </div>
        </div>
      </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã—Ö–æ–¥–∞ -->
    <div id="logoutModal" class="logout-modal" style="display: none">
      <div class="logout-modal-content">
        <h3>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤—ã—Ö–æ–¥–∞</h3>
        <p>–í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã?</p>
        <div class="logout-modal-buttons">
          <button id="confirmLogout" class="logout-confirm-btn">
            –î–∞, –≤—ã–π—Ç–∏
          </button>
          <button id="cancelLogout" class="logout-cancel-btn">–û—Ç–º–µ–Ω–∞</button>
        </div>
      </div>
    </div>
    <div id="logoutOverlay" class="logout-overlay" style="display: none"></div>

    <!-- Modal for tooltips -->
    <div id="tooltipOverlay" class="tooltip-overlay"></div>
    <div id="tooltipModal" class="tooltip-modal"></div>

    <style>
      .hex-challenge {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        border: 3px solid #4d36db;
        text-align: center;
        max-width: 750px;
        width: 95%;
        max-height: 90vh;
        overflow-y: auto;
      }

      .hex-challenge h3 {
        color: #4d36db;
        margin-bottom: 15px;
        font-size: 20px;
      }

      .hex-challenge p {
        color: #666;
        margin-bottom: 20px;
        font-style: italic;
      }

      /* –°–∏—Å—Ç–µ–º–∞ –ø–æ–¥—Å–∫–∞–∑–æ–∫ */
      .hint-system {
        margin-bottom: 25px;
      }

      .hint-toggle-btn {
        padding: 12px 24px;
        background: linear-gradient(135deg, #17a2b8, #138496);
        color: white;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        transition: all 0.3s ease;
        font-family: 'Montserrat', sans-serif;
      }

      .hint-toggle-btn:hover {
        background: linear-gradient(135deg, #138496, #117a8b);
        transform: translateY(-2px);
      }

      .hints-panel {
        background: #e8f4fd;
        border: 2px solid #17a2b8;
        border-radius: 12px;
        padding: 20px;
        margin-top: 15px;
        text-align: left;
        animation: slideDown 0.3s ease-out;
      }

      @keyframes slideDown {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .hints-header h4 {
        color: #17a2b8;
        margin-bottom: 10px;
        text-align: center;
      }

      .hints-header p {
        text-align: center;
        color: #666;
        font-size: 14px;
        margin-bottom: 15px;
      }

      .hint-buttons {
        display: flex;
        gap: 8px;
        margin-bottom: 15px;
        flex-wrap: wrap;
        justify-content: center;
      }

      .hint-btn {
        padding: 8px 12px;
        background: white;
        border: 2px solid #17a2b8;
        border-radius: 6px;
        cursor: pointer;
        font-size: 12px;
        font-weight: 600;
        transition: all 0.3s ease;
        color: #17a2b8;
      }

      .hint-btn:hover,
      .hint-btn.active {
        background: #17a2b8;
        color: white;
        transform: translateY(-1px);
      }

      .hint-content {
        background: white;
        padding: 15px;
        border-radius: 8px;
        border: 1px solid #17a2b8;
        min-height: 60px;
      }

      .hint-message {
        color: #666;
        text-align: center;
        font-style: italic;
      }

      /* –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä */
      .hex-calculator {
        background: #f8f9fa;
        padding: 25px;
        border-radius: 10px;
        margin-bottom: 20px;
      }

      .hex-calculator h4 {
        color: #4d36db;
        margin-bottom: 20px;
        font-size: 18px;
      }

      .calc-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 15px;
        padding: 10px;
        background: white;
        border-radius: 8px;
        gap: 10px;
      }

      .calc-row.final-row {
        background: #e8f5e8;
        border: 2px solid #28a745;
        font-weight: bold;
      }

      .label {
        font-family: monospace;
        font-size: 16px;
        font-weight: bold;
        min-width: 120px;
        text-align: left;
      }

      .calc-row input {
        width: 100px;
        height: 40px;
        font-size: 16px;
        text-align: center;
        border: 2px solid #4d36db;
        border-radius: 5px;
        font-family: monospace;
        font-weight: bold;
      }

      .calc-row input:focus {
        outline: none;
        box-shadow: 0 0 5px rgba(77, 54, 219, 0.3);
      }

      .calc-row input.correct {
        border-color: #28a745;
        background: #d4edda;
      }

      .calc-row input.incorrect {
        border-color: #dc3545;
        background: #f8d7da;
      }

      .check-mark {
        color: #28a745;
        font-size: 20px;
        font-weight: bold;
        opacity: 0;
        transition: opacity 0.3s ease;
        min-width: 20px;
      }

      .check-mark.visible {
        opacity: 1;
      }

      .step-help-btn {
        width: 25px;
        height: 25px;
        background: #ffc107;
        color: #212529;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        font-size: 12px;
        font-weight: bold;
        transition: all 0.3s ease;
      }

      .step-help-btn:hover {
        background: #e0a800;
        transform: scale(1.1);
      }

      .check-final-btn {
        padding: 10px 20px;
        background: #28a745;
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
        font-family: 'Montserrat', sans-serif;
      }

      .check-final-btn:hover {
        background: #218838;
        transform: translateY(-1px);
      }

      /* –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ */
      .dynamic-hints {
        margin-bottom: 20px;
      }

      .hint-card {
        display: flex;
        justify-content: space-around;
        flex-wrap: wrap;
        gap: 10px;
        margin-bottom: 15px;
      }

      .hint {
        background: #fff3cd;
        color: #856404;
        padding: 8px 12px;
        border-radius: 5px;
        font-size: 14px;
        font-weight: bold;
        border: 1px solid #ffeaa7;
        transition: all 0.3s ease;
      }

      .hint:hover {
        background: #ffc107;
        color: #212529;
        transform: scale(1.05);
      }

      .smart-feedback {
        background: linear-gradient(135deg, #e3f2fd, #bbdefb);
        border: 2px solid #2196f3;
        border-radius: 10px;
        padding: 15px;
        margin: 15px 0;
        animation: fadeIn 0.5s ease-out;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .feedback-content {
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .feedback-icon {
        font-size: 24px;
        animation: bounce 2s infinite;
      }

      @keyframes bounce {
        0%,
        20%,
        50%,
        80%,
        100% {
          transform: translateY(0);
        }
        40% {
          transform: translateY(-5px);
        }
        60% {
          transform: translateY(-3px);
        }
      }

      .feedback-text {
        color: #1976d2;
        font-weight: 600;
        line-height: 1.4;
      }

      .hex-result {
        margin-top: 20px;
        padding: 15px;
        border-radius: 10px;
        font-weight: bold;
        min-height: 20px;
        transition: all 0.3s ease;
      }

      .hex-result.success {
        background: #d4edda;
        color: #155724;
        border: 2px solid #28a745;
      }

      .hex-result.error {
        background: #f8d7da;
        color: #721c24;
        border: 2px solid #dc3545;
      }

      /* –°—Ç–∏–ª–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ */
      .iconexit {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 40px;
        height: 40px;
        background-color: #f0f0f0;
        border-radius: 50%;
        cursor: pointer;
        font-size: 18px;
        transition: all 0.3s ease;
        text-decoration: none;
        border: 2px solid transparent;
      }

      .iconexit:hover {
        background-color: #dc3545;
        color: white;
        border-color: #dc3545;
        transform: scale(1.1);
      }

      .nameuser {
        font-weight: 600;
        color: #4d36db;
        margin-right: 15px;
        font-size: 16px;
      }

      .nameuser.loading {
        color: #999;
        animation: pulse 1.5s ease-in-out infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
      }

      .logout-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.6);
        z-index: 9999;
      }

      .logout-modal {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        border-radius: 15px;
        padding: 30px;
        z-index: 10000;
        max-width: 400px;
        width: 90%;
        text-align: center;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        border: 3px solid #4d36db;
      }

      .logout-modal h3 {
        color: #4d36db;
        margin-bottom: 15px;
        font-size: 20px;
        font-weight: 600;
      }

      .logout-modal p {
        color: #666;
        margin-bottom: 25px;
        font-size: 16px;
        line-height: 1.5;
      }

      .logout-modal-buttons {
        display: flex;
        gap: 15px;
        justify-content: center;
      }

      .logout-confirm-btn,
      .logout-cancel-btn {
        padding: 12px 20px;
        border: none;
        border-radius: 8px;
        font-family: 'Montserrat', sans-serif;
        font-weight: 600;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.3s ease;
        min-width: 100px;
      }

      .logout-confirm-btn {
        background: linear-gradient(135deg, #dc3545, #c82333);
        color: white;
      }

      .logout-cancel-btn {
        background: #f8f9fa;
        color: #4d36db;
        border: 2px solid #4d36db;
      }

      @media (max-width: 768px) {
        .hex-challenge {
          top: 50%;
          padding: 20px;
          margin: 10px;
          max-height: 95vh;
        }

        .calc-row {
          flex-direction: column;
          gap: 10px;
          text-align: center;
        }

        .label {
          min-width: auto;
        }

        .hint-card {
          justify-content: center;
        }

        .hint {
          font-size: 12px;
          padding: 6px 8px;
        }

        .hint-buttons {
          justify-content: center;
        }

        .feedback-content {
          flex-direction: column;
          text-align: center;
          gap: 10px;
        }
      }
    </style>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="js/slick.min.js"></script>
    <script src="js/jquery.fancybox.min.js"></script>
    <script src="js/help.js"></script>
    <script src="js/main-6class.js"></script>

    <script>
      document.addEventListener('DOMContentLoaded', function () {
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        if (!requireAuth()) return;

        const currentUser = getCurrentUser();
        if (currentUser) {
          document.getElementById('userName').textContent = currentUser.name;
          document.getElementById('userName').classList.remove('loading');
        } else {
          logout();
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        const logoutBtn = document.getElementById('logoutBtn');
        const logoutModal = document.getElementById('logoutModal');
        const logoutOverlay = document.getElementById('logoutOverlay');
        const confirmLogout = document.getElementById('confirmLogout');
        const cancelLogout = document.getElementById('cancelLogout');

        logoutBtn.addEventListener('click', e => {
          e.preventDefault();
          logoutModal.style.display = 'block';
          logoutOverlay.style.display = 'block';
        });

        confirmLogout.addEventListener('click', () => {
          confirmLogout.textContent = '–í—ã—Ö–æ–¥–∏–º...';
          confirmLogout.disabled = true;
          setTimeout(logout, 500);
        });

        function hideLogoutModal() {
          logoutModal.style.display = 'none';
          logoutOverlay.style.display = 'none';
          confirmLogout.textContent = '–î–∞, –≤—ã–π—Ç–∏';
          confirmLogout.disabled = false;
        }

        cancelLogout.addEventListener('click', hideLogoutModal);
        logoutOverlay.addEventListener('click', hideLogoutModal);

        // –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ —É—Ä–æ–∫–∞
        const step1Input = document.getElementById('step1');
        const step2Input = document.getElementById('step2');
        const step3Input = document.getElementById('step3');
        const finalInput = document.getElementById('finalAnswer');
        const checkFinalBtn = document.getElementById('checkFinal');
        const resultDiv = document.getElementById('calculatorResult');
        const nextArrow = document.getElementById('nextArrow');

        // –°–∏—Å—Ç–µ–º–∞ –ø–æ–¥—Å–∫–∞–∑–æ–∫
        const toggleHintsBtn = document.getElementById('toggleHints');
        const hintsPanel = document.getElementById('hintsPanel');
        const hintButtons = document.querySelectorAll('.hint-btn');
        const hintContent = document.getElementById('hintContent');
        const stepHelpButtons = document.querySelectorAll('.step-help-btn');
        const smartFeedback = document.getElementById('smartFeedback');
        const feedbackText = document.getElementById('feedbackText');

        // –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
        const answers = {
          step1: 3840, // 15 √ó 256
          step2: 240, // 15 √ó 16
          step3: 15, // 15 √ó 1
          final: 4095, // 3840 + 240 + 15
        };

        let completedSteps = 0;
        let hintsVisible = false;

        // –ö–æ–Ω—Ç–µ–Ω—Ç –ø–æ–¥—Å–∫–∞–∑–æ–∫
        const hintContents = {
          basics: `
            <h5>üî§ –û—Å–Ω–æ–≤—ã —à–µ—Å—Ç–Ω–∞–¥—Ü–∞—Ç–µ—Ä–∏—á–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã</h5>
            <p><strong>–¶–∏—Ñ—Ä—ã:</strong> 0, 1, 2, 3, 4, 5, 6, 7, 8, 9</p>
            <p><strong>–ë—É–∫–≤—ã:</strong> A=10, B=11, C=12, D=13, E=14, <span style="color: #dc3545; font-weight: bold;">F=15</span></p>
            <p><strong>–û—Å–Ω–æ–≤–∞–Ω–∏–µ:</strong> 16 (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è 16 —Å–∏–º–≤–æ–ª–æ–≤)</p>
            <div style="background: #fff3cd; padding: 10px; border-radius: 5px; margin-top: 10px;">
              üí° <strong>–ó–∞–ø–æ–º–Ω–∏:</strong> F - —ç—Ç–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ü–∏—Ñ—Ä–∞ –≤ HEX = 15 –≤ –¥–µ—Å—è—Ç–∏—á–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ
            </div>
          `,
          powers: `
            <h5>üî¢ –°—Ç–µ–ø–µ–Ω–∏ —á–∏—Å–ª–∞ 16</h5>
            <div style="font-family: monospace; font-size: 16px; line-height: 1.8;">
              <div>16‚Å∞ = 1</div>
              <div>16¬π = 16</div>
              <div><strong style="color: #dc3545;">16¬≤ = 16 √ó 16 = 256</strong></div>
              <div>16¬≥ = 16 √ó 16 √ó 16 = 4096</div>
            </div>
            <div style="background: #e3f2fd; padding: 10px; border-radius: 5px; margin-top: 10px;">
              üí° <strong>–ü–æ–¥—Å–∫–∞–∑–∫–∞:</strong> –ö–∞–∂–¥–∞—è –ø–æ–∑–∏—Ü–∏—è –≤ HEX —á–∏—Å–ª–µ –∏–º–µ–µ—Ç –≤–µ—Å, —Ä–∞–≤–Ω—ã–π —Å—Ç–µ–ø–µ–Ω–∏ 16
            </div>
          `,
          formula: `
            <h5>üìê –§–æ—Ä–º—É–ª–∞ –¥–ª—è 0xFFF</h5>
            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; font-family: monospace;">
              <div style="font-size: 18px; text-align: center; margin-bottom: 10px;">
                <strong>FFF‚ÇÅ‚ÇÜ = F√ó16¬≤ + F√ó16¬π + F√ó16‚Å∞</strong>
              </div>
              <div style="text-align: center; color: #666;">
                ‚Üì –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ–º F = 15 ‚Üì
              </div>
              <div style="font-size: 16px; text-align: center; margin-top: 10px;">
                <strong>15√ó256 + 15√ó16 + 15√ó1</strong>
              </div>
            </div>
            <div style="background: #d4edda; padding: 10px; border-radius: 5px; margin-top: 10px;">
              ‚úÖ <strong>–ü—Ä–∏–Ω—Ü–∏–ø:</strong> –ö–∞–∂–¥–∞—è –ø–æ–∑–∏—Ü–∏—è —É–º–Ω–æ–∂–∞–µ—Ç—Å—è –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é —Å—Ç–µ–ø–µ–Ω—å 16
            </div>
          `,
          steps: `
            <h5>üë£ –ü–æ—à–∞–≥–æ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ</h5>
            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
              <div style="margin-bottom: 10px;"><strong>–®–∞–≥ 1:</strong> F √ó 16¬≤ = 15 √ó 256 = <span style="color: #28a745; font-weight: bold;">3840</span></div>
              <div style="margin-bottom: 10px;"><strong>–®–∞–≥ 2:</strong> F √ó 16¬π = 15 √ó 16 = <span style="color: #28a745; font-weight: bold;">240</span></div>
              <div style="margin-bottom: 10px;"><strong>–®–∞–≥ 3:</strong> F √ó 16‚Å∞ = 15 √ó 1 = <span style="color: #28a745; font-weight: bold;">15</span></div>
              <hr style="margin: 15px 0;">
              <div><strong>–ò—Ç–æ–≥–æ:</strong> 3840 + 240 + 15 = <span style="color: #dc3545; font-weight: bold; font-size: 18px;">4095</span></div>
            </div>
            <div style="background: #fff3cd; padding: 10px; border-radius: 5px; margin-top: 10px;">
              üí° <strong>–ü—Ä–æ–≤–µ—Ä–∫–∞:</strong> 4095‚ÇÅ‚ÇÄ = FFF‚ÇÅ‚ÇÜ (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ 3-–∑–Ω–∞—á–Ω–æ–µ HEX —á–∏—Å–ª–æ)
            </div>
          `,
          calculator: `
            <h5>üßÆ –ü–æ–º–æ—â—å —Å –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–æ–º</h5>
            <div style="background: #e8f4fd; padding: 15px; border-radius: 8px;">
              <p><strong>–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è:</strong></p>
              <ol style="text-align: left; padding-left: 20px;">
                <li>–í—ã—á–∏—Å–ª–∏ –∫–∞–∂–¥—ã–π —à–∞–≥ –ø–æ –ø–æ—Ä—è–¥–∫—É</li>
                <li>–ò—Å–ø–æ–ª—å–∑—É–π –ø–æ–¥—Å–∫–∞–∑–∫–∏ —Å–ø—Ä–∞–≤–∞ –æ—Ç –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—è</li>
                <li>–ó–µ–ª–µ–Ω–∞—è –≥–∞–ª–æ—á–∫–∞ ‚úì –æ–∑–Ω–∞—á–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç</li>
                <li>–ö—Ä–∞—Å–Ω–æ–µ –ø–æ–ª–µ –æ–∑–Ω–∞—á–∞–µ—Ç –æ—à–∏–±–∫—É - –ø–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑</li>
                <li>–ü–æ—Å–ª–µ –≤—Å–µ—Ö —à–∞–≥–æ–≤ —Å–ª–æ–∂–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</li>
              </ol>
            </div>
            <div style="background: #d1ecf1; padding: 10px; border-radius: 5px; margin-top: 10px;">
              üéØ <strong>–°–æ–≤–µ—Ç:</strong> –ï—Å–ª–∏ –∑–∞—Å—Ç—Ä—è–ª, –Ω–∞–∂–º–∏ ‚ùì —Ä—è–¥–æ–º —Å –ø–æ–ª–µ–º –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –ø–æ–º–æ—â–∏
            </div>
          `,
        };

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–∏—Å—Ç–µ–º—ã –ø–æ–¥—Å–∫–∞–∑–æ–∫
        toggleHintsBtn.addEventListener('click', () => {
          hintsVisible = !hintsVisible;
          hintsPanel.style.display = hintsVisible ? 'block' : 'none';
          toggleHintsBtn.textContent = hintsVisible
            ? 'üîº –°–∫—Ä—ã—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫–∏'
            : 'üí° –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫–∏';
        });

        hintButtons.forEach(btn => {
          btn.addEventListener('click', () => {
            // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
            hintButtons.forEach(b => b.classList.remove('active'));
            // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –∫ –Ω–∞–∂–∞—Ç–æ–π –∫–Ω–æ–ø–∫–µ
            btn.classList.add('active');

            const hintType = btn.dataset.hint;
            hintContent.innerHTML = hintContents[hintType];
          });
        });

        // –ü–æ–º–æ—â—å –ø–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º —à–∞–≥–∞–º
        stepHelpButtons.forEach(btn => {
          btn.addEventListener('click', () => {
            const step = btn.dataset.step;
            let helpMessage = '';

            switch (step) {
              case '1':
                helpMessage =
                  '–®–∞–≥ 1: F = 15, –∞ 16¬≤ = 256. –ü–µ—Ä–µ–º–Ω–æ–∂—å: 15 √ó 256 = 3840';
                break;
              case '2':
                helpMessage =
                  '–®–∞–≥ 2: F = 15, –∞ 16¬π = 16. –ü–µ—Ä–µ–º–Ω–æ–∂—å: 15 √ó 16 = 240';
                break;
              case '3':
                helpMessage =
                  '–®–∞–≥ 3: F = 15, –∞ 16‚Å∞ = 1. –ü–µ—Ä–µ–º–Ω–æ–∂—å: 15 √ó 1 = 15';
                break;
              case 'final':
                helpMessage = '–°–ª–æ–∂–∏ –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã: 3840 + 240 + 15 = 4095';
                break;
            }

            showSmartFeedback(helpMessage, 'ü§ñ');
          });
        });

        function showSmartFeedback(message, icon = 'üí°') {
          feedbackText.innerHTML = message;
          smartFeedback.querySelector('.feedback-icon').textContent = icon;
          smartFeedback.style.display = 'block';

          // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 8 —Å–µ–∫—É–Ω–¥
          setTimeout(() => {
            smartFeedback.style.display = 'none';
          }, 8000);
        }

        function checkStep(input, stepNum, checkMarkId) {
          const userAnswer = parseInt(input.value);
          const correctAnswer = answers[`step${stepNum}`];
          const checkMark = document.getElementById(checkMarkId);

          if (userAnswer === correctAnswer) {
            input.classList.remove('incorrect');
            input.classList.add('correct');
            checkMark.classList.add('visible');
            completedSteps++;

            // –£–º–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å –ø—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –æ—Ç–≤–µ—Ç–µ
            const encouragements = [
              '–û—Ç–ª–∏—á–Ω–æ! üéâ',
              '–ü—Ä–∞–≤–∏–ª—å–Ω–æ! üëç',
              '–°—É–ø–µ—Ä! ‚≠ê',
              '–ú–æ–ª–æ–¥–µ—Ü! üéØ',
            ];
            const randomEncouragement =
              encouragements[Math.floor(Math.random() * encouragements.length)];
            showSmartFeedback(
              `${randomEncouragement} –®–∞–≥ ${stepNum} –≤—ã–ø–æ–ª–Ω–µ–Ω –≤–µ—Ä–Ω–æ!`,
              '‚úÖ'
            );

            if (completedSteps === 3) {
              // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ–º –∏—Ç–æ–≥–æ–≤–æ–µ –ø–æ–ª–µ –ø–æ–¥—Å–∫–∞–∑–∫–æ–π
              const sum = answers.step1 + answers.step2 + answers.step3;
              finalInput.placeholder = `${answers.step1} + ${answers.step2} + ${answers.step3} = ?`;
              showSmartFeedback(
                '–í—Å–µ —à–∞–≥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã! –¢–µ–ø–µ—Ä—å —Å–ª–æ–∂–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏—Ç–æ–≥–æ–≤–æ–≥–æ –æ—Ç–≤–µ—Ç–∞.',
                'üéØ'
              );
            }

            return true;
          } else if (userAnswer && !isNaN(userAnswer)) {
            input.classList.remove('correct');
            input.classList.add('incorrect');
            checkMark.classList.remove('visible');

            // –£–º–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞
            let errorMessage = '';
            if (stepNum === 1) {
              if (userAnswer === 15 * 16) {
                errorMessage =
                  '–¢—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª 16¬π –≤–º–µ—Å—Ç–æ 16¬≤. –ù—É–∂–Ω–æ: 15 √ó 256 = 3840';
              } else if (userAnswer === 15) {
                errorMessage =
                  '–¢—ã –∑–∞–±—ã–ª —É–º–Ω–æ–∂–∏—Ç—å –Ω–∞ —Å—Ç–µ–ø–µ–Ω—å! –ù—É–∂–Ω–æ: 15 √ó 256 = 3840';
              } else {
                errorMessage = '–®–∞–≥ 1: 15 √ó 256 = 3840. –ü—Ä–æ–≤–µ—Ä—å –≤—ã—á–∏—Å–ª–µ–Ω–∏—è!';
              }
            } else if (stepNum === 2) {
              if (userAnswer === 15 * 256) {
                errorMessage =
                  '–¢—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª 16¬≤ –≤–º–µ—Å—Ç–æ 16¬π. –ù—É–∂–Ω–æ: 15 √ó 16 = 240';
              } else if (userAnswer === 15) {
                errorMessage = '–¢—ã –∑–∞–±—ã–ª —É–º–Ω–æ–∂–∏—Ç—å –Ω–∞ 16! –ù—É–∂–Ω–æ: 15 √ó 16 = 240';
              } else {
                errorMessage = '–®–∞–≥ 2: 15 √ó 16 = 240. –ü–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑!';
              }
            } else if (stepNum === 3) {
              if (userAnswer !== 15) {
                errorMessage = '–®–∞–≥ 3: 15 √ó 1 = 15. –≠—Ç–æ —Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π —à–∞–≥!';
              }
            }

            showSmartFeedback(errorMessage, '‚ùå');
            return false;
          }

          input.classList.remove('correct', 'incorrect');
          checkMark.classList.remove('visible');
          return false;
        }

        function checkFinalAnswer() {
          const userAnswer = parseInt(finalInput.value);

          if (completedSteps < 3) {
            showResult('–°–Ω–∞—á–∞–ª–∞ —Ä–µ—à–∏ –≤—Å–µ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —à–∞–≥–∏!', 'error');
            showSmartFeedback(
              '–¢–µ–±–µ –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –≤—Å–µ —Ç—Ä–∏ —à–∞–≥–∞, –ø—Ä–µ–∂–¥–µ —á–µ–º –≤—ã—á–∏—Å–ª—è—Ç—å –∏—Ç–æ–≥–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç.',
              '‚ö†Ô∏è'
            );
            return;
          }

          if (isNaN(userAnswer) || finalInput.value.trim() === '') {
            showResult('–í–≤–µ–¥–∏ –∏—Ç–æ–≥–æ–≤—ã–π –æ—Ç–≤–µ—Ç!', 'error');
            return;
          }

          if (userAnswer === answers.final) {
            showResult('üéâ –ü—Ä–µ–≤–æ—Å—Ö–æ–¥–Ω–æ! 0xFFF‚ÇÅ‚ÇÜ = 4095‚ÇÅ‚ÇÄ', 'success');
            nextArrow.style.display = 'block';
            checkFinalBtn.disabled = true;
            finalInput.disabled = true;

            showSmartFeedback(
              '–ü–æ–∑–¥—Ä–∞–≤–ª—è—é! –¢—ã –æ—Å–≤–æ–∏–ª –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Ç—Ä—ë—Ö–∑–Ω–∞—á–Ω—ã—Ö —à–µ—Å—Ç–Ω–∞–¥—Ü–∞—Ç–µ—Ä–∏—á–Ω—ã—Ö —á–∏—Å–µ–ª! üéì',
              'üèÜ'
            );

            setTimeout(() => {
              resultDiv.innerHTML +=
                '<br><small>‚ú® –ü–æ–ª–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ: 15√ó256 + 15√ó16 + 15√ó1 = 3840 + 240 + 15 = 4095</small>' +
                '<br><small>üéØ FFF‚ÇÅ‚ÇÜ - —ç—Ç–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —Ç—Ä—ë—Ö–∑–Ω–∞—á–Ω–æ–µ —à–µ—Å—Ç–Ω–∞–¥—Ü–∞—Ç–µ—Ä–∏—á–Ω–æ–µ —á–∏—Å–ª–æ!</small>';
            }, 1000);
          } else {
            // –£–º–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –æ—à–∏–±–æ–∫
            const expectedSum = answers.step1 + answers.step2 + answers.step3;
            if (userAnswer === expectedSum - answers.step3) {
              showResult('‚ùå –¢—ã –∑–∞–±—ã–ª –ø—Ä–∏–±–∞–≤–∏—Ç—å —Ç—Ä–µ—Ç–∏–π —à–∞–≥ (15)', 'error');
              showSmartFeedback(
                '–ü–æ—á—Ç–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ! –¢—ã –∑–∞–±—ã–ª –ø—Ä–∏–±–∞–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ç—Ä–µ—Ç—å–µ–≥–æ —à–∞–≥–∞: + 15',
                'üí°'
              );
            } else if (userAnswer === answers.step1 + answers.step2) {
              showResult('‚ùå –ù–µ –∑–∞–±—É–¥—å –ø—Ä–æ —Ç—Ä–µ—Ç–∏–π —à–∞–≥: + 15', 'error');
            } else if (userAnswer > 5000) {
              showResult('‚ùå –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ! –ü—Ä–æ–≤–µ—Ä—å —Å–ª–æ–∂–µ–Ω–∏–µ', 'error');
            } else if (userAnswer < 3000) {
              showResult(
                '‚ùå –°–ª–∏—à–∫–æ–º –º–∞–ª–æ! –ü—Ä–æ–≤–µ—Ä—å, –≤—Å–µ –ª–∏ —à–∞–≥–∏ —É—á—Ç–µ–Ω—ã',
                'error'
              );
            } else {
              showResult(
                `‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ. –°–ª–æ–∂–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã: ${answers.step1} + ${answers.step2} + ${answers.step3}`,
                'error'
              );
              showSmartFeedback(
                '–ü—Ä–æ–≤–µ—Ä—å –∫–∞–∂–¥–æ–µ —Å–ª–∞–≥–∞–µ–º–æ–µ –∏ –ø–æ–ø—Ä–æ–±—É–π —Å–ª–æ–∂–∏—Ç—å –µ—â–µ —Ä–∞–∑. –ò—Å–ø–æ–ª—å–∑—É–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ!',
                'üî¢'
              );
            }
          }
        }

        function showResult(message, type) {
          resultDiv.innerHTML = message;
          resultDiv.className = `hex-result ${type}`;
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞
        step1Input.addEventListener('input', () =>
          checkStep(step1Input, 1, 'check1')
        );
        step2Input.addEventListener('input', () =>
          checkStep(step2Input, 2, 'check2')
        );
        step3Input.addEventListener('input', () =>
          checkStep(step3Input, 3, 'check3')
        );

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
        checkFinalBtn.addEventListener('click', checkFinalAnswer);
        finalInput.addEventListener('keypress', e => {
          if (e.key === 'Enter') {
            checkFinalAnswer();
          }
        });

        // –ê–≤—Ç–æ—Ñ–æ–∫—É—Å –Ω–∞ –ø–µ—Ä–≤–æ–µ –ø–æ–ª–µ
        step1Input.focus();

        // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        setInterval(() => {
          if (
            !getCurrentUser() ||
            !validateSessionToken(SessionUtils.get('STORYHUB_auth_token'))
          ) {
            alert('–í–∞—à–∞ —Å–µ—Å—Å–∏—è –∏—Å—Ç–µ–∫–ª–∞. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –∑–∞–Ω–æ–≤–æ.');
            logout();
          }
        }, 60000);

        console.log(
          '‚úÖ –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π —É—Ä–æ–∫ —à–µ—Å—Ç–Ω–∞–¥—Ü–∞—Ç–µ—Ä–∏—á–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã —Å —É–º–Ω—ã–º–∏ –ø–æ–¥—Å–∫–∞–∑–∫–∞–º–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω'
        );
      });

      // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
      window.logout = logout;
      window.getCurrentUser = getCurrentUser;
      window.requireAuth = requireAuth;
    </script>
    <script src="js/video-modal.js"></script>
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –≤–∏–¥–µ–æ-–ø–ª–µ–µ—Ä -->
    <script src="js/main.js"></script>

    <script>
      // –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è –≤–∏–¥–µ–æ-–ø–ª–µ–µ—Ä–∞
      let videoModal = null;

      document.addEventListener('DOMContentLoaded', function () {
        console.log('üìö –£—Ä–æ–∫ 1 - —á–∞—Å—Ç—å 3 –∑–∞–≥—Ä—É–∂–µ–Ω');

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–∏–¥–µ–æ-–ø–ª–µ–µ—Ä–∞
        initVideoPlayer();

        console.log('‚úÖ –£—Ä–æ–∫ 1-3 —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
      });

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–∏–¥–µ–æ-–ø–ª–µ–µ—Ä–∞ –¥–ª—è —ç—Ç–æ–π —á–∞—Å—Ç–∏ —É—Ä–æ–∫–∞
      function initVideoPlayer() {
        if (typeof window.createVideoModal === 'function') {
          try {
            videoModal = window.createVideoModal({
              videoUrl: 'videos/IMG_5808.mp4', // –í–∏–¥–µ–æ –¥–ª—è —ç—Ç–æ–π —á–∞—Å—Ç–∏ —É—Ä–æ–∫–∞
              buttonTitle: '–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤–∏–¥–µ–æ —Å –∂–µ—Å—Ç–∞–º–∏ –ø–æ —É—Ä–æ–∫—É',
              buttonIcon: 'ü§ö',
              buttonPosition: 'top-right',
              autoplay: true,
              controls: true,
              loop: false,
            });

            console.log('üé• –í–∏–¥–µ–æ-–ø–ª–µ–µ—Ä –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è —É—Ä–æ–∫–∞ 1-3');
          } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤–∏–¥–µ–æ-–ø–ª–µ–µ—Ä–∞:', error);
          }
        } else {
          console.warn('‚ö†Ô∏è –ú–æ–¥—É–ª—å –≤–∏–¥–µ–æ-–ø–ª–µ–µ—Ä–∞ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
        }
      }

      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤–∏–¥–µ–æ (–º–æ–∂–µ—Ç –ø–æ–Ω–∞–¥–æ–±–∏—Ç—å—Å—è)
      window.updateLessonVideo = function (videoUrl, title, icon) {
        if (videoModal) {
          videoModal.updateVideo(videoUrl);
          videoModal.options.buttonTitle = title;
          videoModal.options.buttonIcon = icon;
        }
      };

      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–∫—Ä—ã—Ç–∏—è/–ø–æ–∫–∞–∑–∞ –≤–∏–¥–µ–æ –∫–Ω–æ–ø–∫–∏
      window.toggleVideoButton = function (show = true) {
        if (videoModal && videoModal.button) {
          videoModal.button.style.display = show ? 'flex' : 'none';
        }
      };

      // –û—á–∏—Å—Ç–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤ –ø—Ä–∏ —É—Ö–æ–¥–µ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
      window.addEventListener('beforeunload', function () {
        if (videoModal) {
          videoModal.destroy();
        }
      });
    </script>
  </body>
</html>
